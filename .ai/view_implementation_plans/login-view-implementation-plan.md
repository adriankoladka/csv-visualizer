# View Implementation Plan: login.html

## 1. Overview
This document outlines the implementation plan for the `login.html` view. This view's primary purpose is to provide a secure interface for users to authenticate before gaining access to the application's core features. It is rendered by the `auth.login` view function and serves as the main entry point for all unauthenticated users. The template file for this view is `app/templates/auth/login.html`.

## 2. UI Components
*   **Inheritance:** The template will extend the `base.html` template to ensure a consistent layout, header, and access to the flash messaging system.
*   **Login Form:** The core of the view is an HTML `<form>` with the following attributes:
    *   `method="POST"`: The form data will be sent to the server in the body of the HTTP request.
    *   `action="{{ url_for('auth.login') }}"`: The form will submit its data to the `login` view function within the `auth` blueprint.
*   **Input Fields:**
    *   **Username:** A labeled `<input>` field with `type="text"` and `name="username"`. The `required` attribute will be used for basic client-side validation.
    *   **Password:** A labeled `<input>` field with `type="password"` and `name="password"`. The `required` attribute will also be used here.
*   **Submit Button:** A `<button>` with `type="submit"` and the text "Login" to trigger the form submission.
*   **Feedback Display:** The view will implicitly use the flash message display area inherited from `base.html` to show error messages like "Invalid credentials."

## 3. Associated Route
*   **View Function:** The view and its logic are handled by the `login()` function located in `app/auth/routes.py`.
*   **URL:** The route is accessible at the `/login` URL.
*   **HTTP Methods:** The route is configured to accept both `GET` and `POST` requests.
    *   A `GET` request is used to display the login page.
    *   A `POST` request is used to process the submitted login credentials.

## 4. Backend Logic
The logic is split based on the HTTP request method.
*   **On `GET` request:** No specific backend logic is executed. The view function proceeds directly to rendering the template.
*   **On `POST` request:**
    1.  The `username` and `password` are extracted from the `request.form` object.
    2.  **Validation:** The system checks if either `username` or `password` is empty. If so, it flashes an error message ("Username and password are required.") and redirects the user back to the login page.
    3.  **Authentication:** The `authenticate_user(username, password)` service function is called to verify the credentials against the in-memory user store.
    4.  **Session Management:**
        *   If authentication is successful (the service returns a `User` object), the `login_user(user)` function from Flask-Login is called. This function establishes the user's session by storing their ID in a secure cookie.
        *   If authentication fails (the service returns `None`), an "Invalid credentials." message is flashed.

## 5. Response
The server's response depends on the method and the outcome of the backend logic.
*   **On `GET` request:** The server will send a `200 OK` HTTP response containing the fully rendered `login.html` page.
*   **On successful `POST` request:** The server will send a `302 Found` HTTP response, which is a redirect. The `Location` header of the response will point to the `/dashboard` URL, as generated by `url_for('main.dashboard')`.
*   **On failed `POST` request (due to validation or authentication failure):** The server will send a `302 Found` HTTP response, redirecting the user back to the `/login` URL. The flashed error message is stored in the session during this redirect and will be displayed when the login page is re-rendered.
